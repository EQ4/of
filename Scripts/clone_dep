#!/bin/bash

cd `dirname $(readlink -f $0)`
cd ..

source commits
source pretty

cd Dependencies
DEPS=`pwd`
cd ..

echo ""

function clu() {
    # $1 Name
    # $2 Folder
    # $3 Branch hash
    # $4 Repository url
    cd     $DEPS/Archive/$2
    if [ ! -f $3.zip ]
    then
           echo "${RED}Downloading $3.zip archive for $1.${NORMAL}"
           wget --progress=bar:force $4 2>&1 | download_progress
    else
           echo "${GREEN}Using existing $3.zip archive for $1.${NORMAL}"
    fi
    unzip -q $3.zip
    mv     $2-* $DEPS/Libs/$2
    rm -rf $2-*
}

source clu

# POCO patch
echo   ""
echo   "${CYAN}Copying pocomsg.h for POCO${NORMAL}"
cp     $DEPS/pocomsg.h $DEPS/Libs/poco/Foundation/src/pocomsg.h
cp     $DEPS/pocomsg.h $DEPS/Libs/poco/Foundation/include/Poco/pocomsg.h
cd     $DEPS/Libs/poco
echo   ""
echo   ${CYAN}poco.patch${NORMAL}
patch  -p1 < $DEPS/poco.patch
echo   ""
echo   ${CYAN}poco_cmake.patch${NORMAL}
patch  -p1 < $DEPS/poco_cmake.patch

